<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='# 创建 循环群 这里的话考虑的是简单情况，使用对应的循环群。对应的方法如下： 1 2 N = 8 gspace = gspaces.Rot2dOnR2(N=N) 然后看这个函数里面的东西： 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 def __init__(self, N: int = None, maximum_frequency: int = None, fibergroup: Group = None): r""" Describes rotation symmetries of the plane :math:`\\R^2`.'><title>e2cnn 内容理解 - 群的创建源码详解 </title><link rel=canonical href=https://runqizhao.cn/p/e2cnn-%E5%86%85%E5%AE%B9%E7%90%86%E8%A7%A3-%E7%BE%A4%E7%9A%84%E5%88%9B%E5%BB%BA%E6%BA%90%E7%A0%81%E8%AF%A6%E8%A7%A3/><link rel=stylesheet href=/scss/style.min.8e60baf4cd3fc55968717a6e39762f4d28ed7ef6007566b6c7970ad0fe907198.css><meta property='og:title' content="e2cnn 内容理解 - 群的创建源码详解 "><meta property='og:description' content='# 创建 循环群 这里的话考虑的是简单情况，使用对应的循环群。对应的方法如下： 1 2 N = 8 gspace = gspaces.Rot2dOnR2(N=N) 然后看这个函数里面的东西： 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 def __init__(self, N: int = None, maximum_frequency: int = None, fibergroup: Group = None): r""" Describes rotation symmetries of the plane :math:`\\R^2`.'><meta property='og:url' content='https://runqizhao.cn/p/e2cnn-%E5%86%85%E5%AE%B9%E7%90%86%E8%A7%A3-%E7%BE%A4%E7%9A%84%E5%88%9B%E5%BB%BA%E6%BA%90%E7%A0%81%E8%AF%A6%E8%A7%A3/'><meta property='og:site_name' content='Runqi Blog'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='机器学习'><meta property='article:tag' content='源码阅读'><meta property='article:tag' content='群论'><meta property='article:published_time' content='2023-12-02T16:55:17+08:00'><meta property='article:modified_time' content='2023-12-02T16:55:17+08:00'><meta name=twitter:title content="e2cnn 内容理解 - 群的创建源码详解 "><meta name=twitter:description content='# 创建 循环群 这里的话考虑的是简单情况，使用对应的循环群。对应的方法如下： 1 2 N = 8 gspace = gspaces.Rot2dOnR2(N=N) 然后看这个函数里面的东西： 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 def __init__(self, N: int = None, maximum_frequency: int = None, fibergroup: Group = None): r""" Describes rotation symmetries of the plane :math:`\\R^2`.'><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu9b4ee4aab7d2c9a136b427e2430a0345_27821_300x0_resize_box_3.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>🍥</span></figure><div class=site-meta><h1 class=site-name><a href=/>Runqi Blog</a></h1><h2 class=site-description>Stay foolish stay hungry</h2></div></header><ol class=menu-social><li><a href=https://github.com/runqi-zhao target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/links/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#创建-循环群>创建 循环群</a></li><li><a href=#总结>总结</a></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/>机器学习</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/e2cnn-%E5%86%85%E5%AE%B9%E7%90%86%E8%A7%A3-%E7%BE%A4%E7%9A%84%E5%88%9B%E5%BB%BA%E6%BA%90%E7%A0%81%E8%AF%A6%E8%A7%A3/>e2cnn 内容理解 - 群的创建源码详解</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Dec 02, 2023</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>18 minute read</time></div></footer></div></header><section class=article-content><h2 id=创建-循环群><a href=#%e5%88%9b%e5%bb%ba-%e5%be%aa%e7%8e%af%e7%be%a4>#</a>
创建 循环群</h2><p>这里的话考虑的是简单情况，使用对应的循环群。对应的方法如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>N</span> <span class=o>=</span> <span class=mi>8</span>
</span></span><span class=line><span class=cl><span class=n>gspace</span> <span class=o>=</span> <span class=n>gspaces</span><span class=o>.</span><span class=n>Rot2dOnR2</span><span class=p>(</span><span class=n>N</span><span class=o>=</span><span class=n>N</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>然后看这个函数里面的东西：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>N</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>maximum_frequency</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span> <span class=n>fibergroup</span><span class=p>:</span> <span class=n>Group</span> <span class=o>=</span> <span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=sa>r</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        Describes rotation symmetries of the plane :math:`\R^2`.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        If ``N &gt; 1``, the class models *discrete* rotations by angles which are multiple of :math:`\frac{2\pi}</span><span class=si>{N}</span><span class=s2>`
</span></span></span><span class=line><span class=cl><span class=s2>        (:class:`~e2cnn.group.CyclicGroup`).
</span></span></span><span class=line><span class=cl><span class=s2>        Otherwise, if ``N=-1``, the class models *continuous* planar rotations (:class:`~e2cnn.group.SO2`).
</span></span></span><span class=line><span class=cl><span class=s2>        In that case the parameter ``maximum_frequency`` is required to specify the maximum frequency of the irreps of
</span></span></span><span class=line><span class=cl><span class=s2>        :class:`~e2cnn.group.SO2` (see its documentation for more details)
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            N (int): number of discrete rotations (integer greater than 1) or ``-1`` for continuous rotations
</span></span></span><span class=line><span class=cl><span class=s2>            maximum_frequency (int): maximum frequency of :class:`~e2cnn.group.SO2`&#39;s irreps if ``N = -1``
</span></span></span><span class=line><span class=cl><span class=s2>            fibergroup (Group, optional): use an already existing instance of the symmetry group.
</span></span></span><span class=line><span class=cl><span class=s2>                   In that case, the other parameters should not be provided.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=n>N</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>or</span> <span class=n>fibergroup</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>,</span> <span class=s2>&#34;Error! Either use the parameter `N` or the parameter `group`!&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>fibergroup</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>fibergroup</span><span class=p>,</span> <span class=n>CyclicGroup</span><span class=p>)</span> <span class=ow>or</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>fibergroup</span><span class=p>,</span> <span class=n>SO2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>assert</span> <span class=n>maximum_frequency</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>,</span> <span class=s2>&#34;Maximum Frequency can&#39;t be set when the group is already provided in input&#34;</span>
</span></span><span class=line><span class=cl>            <span class=n>N</span> <span class=o>=</span> <span class=n>fibergroup</span><span class=o>.</span><span class=n>order</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>N</span><span class=p>,</span> <span class=nb>int</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>N</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>assert</span> <span class=n>maximum_frequency</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>,</span> <span class=s2>&#34;Maximum Frequency can&#39;t be set for finite cyclic groups&#34;</span>
</span></span><span class=line><span class=cl>            <span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;</span><span class=si>{}</span><span class=s1>-Rotations&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>N</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>N</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;Continuous-Rotations&#39;</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;Error! &#34;N&#34; has to be an integer greater than 1 or -1, but got </span><span class=si>{</span><span class=n>N</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>fibergroup</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>N</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>fibergroup</span> <span class=o>=</span> <span class=n>cyclic_group</span><span class=p>(</span><span class=n>N</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>N</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>fibergroup</span> <span class=o>=</span> <span class=n>so2_group</span><span class=p>(</span><span class=n>maximum_frequency</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>(</span><span class=n>Rot2dOnR2</span><span class=p>,</span> <span class=bp>self</span><span class=p>)</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=n>fibergroup</span><span class=p>,</span> <span class=n>name</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>这个注释里面描述的是：描述平面$R^2$的旋转对称性。然后，咱们一句一句看：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>assert</span> <span class=n>N</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>or</span> <span class=n>fibergroup</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>,</span> <span class=s2>&#34;Error! Either use the parameter `N` or the parameter `group`!&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>这段代码要求在使用这段代码所在的函数或程序时，要么提供变量 <code>N</code> 的值，要么提供变量 <code>fibergroup</code> 的值。如果两者都没有提供一个非空的值，就会触发断言错误，以防止程序进一步执行下去。</p><p>接着看下面这段话：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl> <span class=k>if</span> <span class=n>fibergroup</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>fibergroup</span><span class=p>,</span> <span class=n>CyclicGroup</span><span class=p>)</span> <span class=ow>or</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>fibergroup</span><span class=p>,</span> <span class=n>SO2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>assert</span> <span class=n>maximum_frequency</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>,</span> <span class=s2>&#34;Maximum Frequency can&#39;t be set when the group is already provided in input&#34;</span>
</span></span><span class=line><span class=cl>            <span class=n>N</span> <span class=o>=</span> <span class=n>fibergroup</span><span class=o>.</span><span class=n>order</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>N</span><span class=p>,</span> <span class=nb>int</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><code>assert isinstance(fibergroup, CyclicGroup) or isinstance(fibergroup, SO2)</code>：这是一个断言语句，用于检查 <code>fibergroup</code> 是否是 <code>CyclicGroup</code> 类型或者 <code>SO2</code> 类型的实例。如果 <code>fibergroup</code> 不是这两种类型的实例，则会引发一个断言错误。</p><p><code>N = fibergroup.order()</code>：如果之前的条件检查通过（即 <code>fibergroup</code> 不是 <code>None</code> 并且是 <code>CyclicGroup</code> 或 <code>SO2</code> 的实例），则计算 <code>N</code> 的值为 <code>fibergroup</code> 的阶数（order）。</p><p>上面几句，其实一般不会用到，看下面语句：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>if</span> <span class=n>N</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>maximum_frequency</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>,</span> <span class=s2>&#34;Maximum Frequency can&#39;t be set for finite cyclic groups&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;</span><span class=si>{}</span><span class=s1>-Rotations&#39;</span><span class=o>.</span><span class=n>format</span><span class=p>(</span><span class=n>N</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>elif</span> <span class=n>N</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>name</span> <span class=o>=</span> <span class=s1>&#39;Continuous-Rotations&#39;</span>
</span></span><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s1>&#39;Error! &#34;N&#34; has to be an integer greater than 1 or -1, but got </span><span class=si>{</span><span class=n>N</span><span class=si>}</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>然后看下面这些语句，这里的话就是根据你输入参数的给不同的群命令，比如现在 我们输入$N=8$，那么这个时候名字就是<code>8-Rotations</code>。代表 8 个循环群轮换。</p><p>然后看下面：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>if</span> <span class=n>fibergroup</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>N</span> <span class=o>&gt;</span> <span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>fibergroup</span> <span class=o>=</span> <span class=n>cyclic_group</span><span class=p>(</span><span class=n>N</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>N</span> <span class=o>==</span> <span class=o>-</span><span class=mi>1</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>fibergroup</span> <span class=o>=</span> <span class=n>so2_group</span><span class=p>(</span><span class=n>maximum_frequency</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>这里的话我们先说明对应循环群，即看<code>cyclic_group</code>这个函数。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>cyclic_group</span><span class=p>(</span><span class=n>N</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=sa>r</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Builds a cyclic group :math:`C_N`of order ``N``, i.e. the group of ``N`` discrete planar rotations.
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    You should use this factory function to build an instance of :class:`e2cnn.group.CyclicGroup`.
</span></span></span><span class=line><span class=cl><span class=s2>    Only one instance is built and, in case of multiple calls to this function, the same instance is returned.
</span></span></span><span class=line><span class=cl><span class=s2>    In case of multiple calls of this function with different parameters or in case new representations are built
</span></span></span><span class=line><span class=cl><span class=s2>    (eg. through the method :meth:`~e2cnn.group.Group.quotient_representation`), this unique instance is updated with
</span></span></span><span class=line><span class=cl><span class=s2>    the new representations and, therefore, all its references will see the new representations.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Args:
</span></span></span><span class=line><span class=cl><span class=s2>        N (int): number of discrete rotations in the group
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Returns:
</span></span></span><span class=line><span class=cl><span class=s2>        the cyclic group of order ``N``
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>CyclicGroup</span><span class=o>.</span><span class=n>_generator</span><span class=p>(</span><span class=n>N</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>这个的话就是构建结束为<code>N</code>的循环群 $C_{N}$。然后，我们 跳进去这个函数里面看看对应的细节。<strong>注意，里面的内容是对应的核心</strong>。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>_generator</span><span class=p>(</span><span class=n>N</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=s1>&#39;CyclicGroup&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>global</span> <span class=n>_cached_group_instances</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>N</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>_cached_group_instances</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>_cached_group_instances</span><span class=p>[</span><span class=n>N</span><span class=p>]</span> <span class=o>=</span> <span class=n>CyclicGroup</span><span class=p>(</span><span class=n>N</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>_cached_group_instances</span><span class=p>[</span><span class=n>N</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>这段代码定义了一个函数 <code>_generator</code>，它接受一个整数 <code>N</code> 作为参数，并返回一个 <code>CyclicGroup</code> 对象。函数使用了一个全局变量 <code>_cached_group_instances</code>，该变量可能用于存储已经创建过的 <code>CyclicGroup</code> 实例。</p><p>然后，现如何说没有创建对应的循环群，这个时候 需要调用<code>CyclicGroup</code>的初始化，下面看这个函数。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl> <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>N</span><span class=p>:</span> <span class=nb>int</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=sa>r</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>        Build an instance of the cyclic group :math:`C_N` which contains :math:`N` discrete planar rotations.
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        The group elements are :math:`\{e, r, r^2, r^3, \dots, r^{N-1}\}`, with group law
</span></span></span><span class=line><span class=cl><span class=s2>        :math:`r^a \cdot r^b = r^{\ a + b \!\! \mod \!\! N \ }`.
</span></span></span><span class=line><span class=cl><span class=s2>        The cyclic group :math:`C_N` is isomorphic to the integers *modulo* ``N``.
</span></span></span><span class=line><span class=cl><span class=s2>        For this reason, elements are stored as the integers between :math:`0` and :math:`N-1`, where the :math:`k`-th
</span></span></span><span class=line><span class=cl><span class=s2>        element can also be interpreted as the discrete rotation by :math:`k\frac{2\pi}</span><span class=si>{N}</span><span class=s2>`.
</span></span></span><span class=line><span class=cl><span class=s2>        
</span></span></span><span class=line><span class=cl><span class=s2>        Args:
</span></span></span><span class=line><span class=cl><span class=s2>            N (int): order of the group
</span></span></span><span class=line><span class=cl><span class=s2>            
</span></span></span><span class=line><span class=cl><span class=s2>        &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=p>(</span><span class=nb>isinstance</span><span class=p>(</span><span class=n>N</span><span class=p>,</span> <span class=nb>int</span><span class=p>)</span> <span class=ow>and</span> <span class=n>N</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=nb>super</span><span class=p>(</span><span class=n>CyclicGroup</span><span class=p>,</span> <span class=bp>self</span><span class=p>)</span><span class=o>.</span><span class=fm>__init__</span><span class=p>(</span><span class=s2>&#34;C</span><span class=si>%d</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=n>N</span><span class=p>,</span> <span class=kc>False</span><span class=p>,</span> <span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>elements</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=nb>range</span><span class=p>(</span><span class=n>N</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>elements_names</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;e&#39;</span><span class=p>]</span> <span class=o>+</span> <span class=p>[</span><span class=s1>&#39;r</span><span class=si>%d</span><span class=s1>&#39;</span> <span class=o>%</span> <span class=n>i</span> <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>N</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>identity</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>_build_representations</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><p>这个函数就是构建包含$N$离散平面旋转的循环群$C_{N}$的实例。</p><p><code>def __init__(self, N: int):</code>：这是 Python 类的构造函数（initializer），用于创建 <code>CyclicGroup</code> 类的实例。它接受一个整数 <code>N</code> 作为参数，代表循环群的阶或元素的数量。</p><p><code>assert (isinstance(N, int) and N > 0)</code>：这是一个断言语句，用于确保输入的 <code>N</code> 是正整数。如果 <code>N</code> 不是整数或者小于等于零，将会触发 AssertionError。这里的话是因为当小于 0 的时候，我们创建的是离散群，这个时候应该</p><p><code>super(CyclicGroup, self).__init__("C%d" % N, False, True)</code>：这行代码调用了 <code>super()</code> 函数来调用父类的构造函数。它将创建一个新的 <code>CyclicGroup</code> 类的实例，并将群的名称设置为字符串形式的 <code>C</code> 后跟阶数 <code>N</code>。</p><p><code>self.elements = list(range(N))</code>：创建了一个存储群元素的列表，列表中的元素是从 <code>0</code> 到 <code>N-1</code> 的整数，代表循环群中的元素。<strong>注意，这个参数很重要，就是因为有了这个参数，我们才能说使用先缓缓创建对应的循环群</strong>。现在我们<code>N=8</code>，这个时候 elements 是<code>[0,1,2,3,4,5,6,7]</code></p><p><code>self.elements_names = ['e'] + ['r%d' % i for i in range(1, N)]</code>：创建了一个包含群元素名称的列表。群元素名字中 <code>e</code> 代表群的单位元素，其他的元素用 <code>r1</code>, <code>r2</code>, &mldr;, <code>rN-1</code> 表示。现在<code>N=8</code>，<code>elements_name</code>就是<code>['e', 'r1', 'r2', 'r3', 'r4', 'r5', 'r6', 'r7']</code>。</p><p><code>self.identity = 0</code>：将群的单位元素（标识为 <code>e</code>）的索引设为 <code>0</code>。</p><p><code>self._build_representations()</code>：调用了一个名为 <code>_build_representations()</code> 的方法。下面看看这个方法：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl> <span class=k>def</span> <span class=nf>_build_representations</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=sa>r</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Build the irreps and the regular representation for this group
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>N</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>order</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Build all the Irreducible Representations</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>k</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>int</span><span class=p>(</span><span class=n>N</span> <span class=o>//</span> <span class=mi>2</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>irrep</span><span class=p>(</span><span class=n>k</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># Build all Representations</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># add all the irreps to the set of representations already built for this group</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>representations</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=o>**</span><span class=bp>self</span><span class=o>.</span><span class=n>irreps</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># build the regular representation</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>representations</span><span class=p>[</span><span class=s1>&#39;regular&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>regular_representation</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>representations</span><span class=p>[</span><span class=s1>&#39;regular&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>supported_nonlinearities</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=s1>&#39;vectorfield&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>先看对应的 第一句，调用的是 order 函数，对应的函数如下：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl> <span class=k>def</span> <span class=nf>order</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>int</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=sa>r</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Returns the number of elements in this group if it is a finite group, otherwise -1 is returned
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Returns:
</span></span></span><span class=line><span class=cl><span class=s2>        the size of the group or ``-1`` if it is a continuous group
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>elements</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=nb>len</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>elements</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=o>-</span><span class=mi>1</span>
</span></span></code></pre></td></tr></table></div></div><p>现在咱们元素不为 0，这个时候返回的就是 elements 数组的长度，即返回 8。然后再看下面的语句：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Build all the Irreducible Representations</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>k</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>int</span><span class=p>(</span><span class=n>N</span> <span class=o>//</span> <span class=mi>2</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>irrep</span><span class=p>(</span><span class=n>k</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p><code>for k in range(0, int(N // 2) + 1):</code>：这是一个循环结构，用于迭代地构建循环群的不可约表示。<code>range(0, int(N // 2) + 1)</code> 用来生成从 <code>0</code> 到 <code>N // 2</code> 的整数序列，包括 <code>N // 2</code>。在每次迭代中，调用 <code>self.irrep(k)</code> 方法，这个方法可能用来生成和存储循环群的不可约表示。</p><p>注意，我么要时刻记住我们是在一个循环中进来了这里，因此，这里其实会调用四次。</p><p><strong>但是，在后续的代码调试中，其实这部分虽然是进去了，但是里面的函数都没有运行，这是因为 lamda 表达式的特性：lambda 函数将在之后被调用或使用时执行。只有在你实际调用 <code>irrep</code> 变量作为函数，并传递参数 <code>element</code> 和可能的其他参数时，lambda 函数内部的代码才会执行。可以看下图：</strong></p><p><img src=https://img-1312072469.cos.ap-nanjing.myqcloud.com/image-20231203093702515.png loading=lazy alt=image-20231203093702515></p><p>其中的等到<code>build_representations,cyclicgroup.py:221</code>这一行的时候才能进行才会开始调用，相当于函数中的这一句：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=bp>self</span><span class=o>.</span><span class=n>representations</span><span class=p>[</span><span class=s1>&#39;regular&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>regular_representation</span>
</span></span></code></pre></td></tr></table></div></div><p>这里面会使用到 irrep 变量，这个时候才会执行对应函数，我们先说明这个函数的执行过程，出现的变量需要集合后续步骤才能解释明白。</p><p>然后，关于群的 不可约表示可以理解成：群的一个表示，如果它的所有矩阵可以借助于某一个相似变换变
成相同形式的对角方块化矩阵，则此表示是可约的，否则是不可约的。</p><p>ok，下面我们先看<code>irrep</code>这部分的代码。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl>  <span class=k>def</span> <span class=nf>irrep</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>k</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>IrreducibleRepresentation</span><span class=p>:</span>
</span></span><span class=line><span class=cl><span class=sa>r</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>Build the irrep of frequency ``k`` of the current cyclic group.
</span></span></span><span class=line><span class=cl><span class=s2>The frequency has to be a non-negative integer in :math:`\{0, \dots, \left \lfloor N/2 \right \rfloor \}`,
</span></span></span><span class=line><span class=cl><span class=s2>where :math:`N` is the order of the group.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>Args:
</span></span></span><span class=line><span class=cl><span class=s2>    k (int): the frequency of the representation
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>Returns:
</span></span></span><span class=line><span class=cl><span class=s2>    the corresponding irrep
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl><span class=k>assert</span> <span class=mi>0</span> <span class=o>&lt;=</span> <span class=n>k</span> <span class=o>&lt;=</span> <span class=bp>self</span><span class=o>.</span><span class=n>order</span><span class=p>()</span><span class=o>//</span><span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>name</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;irrep_</span><span class=si>{</span><span class=n>k</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=n>name</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>irreps</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>n</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>order</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>base_angle</span> <span class=o>=</span> <span class=mf>2.0</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>pi</span> <span class=o>/</span> <span class=n>n</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>k</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># Trivial representation</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>irrep</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>element</span><span class=p>,</span> <span class=n>identity</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>eye</span><span class=p>(</span><span class=mi>1</span><span class=p>):</span> <span class=n>identity</span>
</span></span><span class=line><span class=cl>        <span class=n>character</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>e</span><span class=p>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=n>supported_nonlinearities</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;pointwise&#39;</span><span class=p>,</span> <span class=s1>&#39;gate&#39;</span><span class=p>,</span> <span class=s1>&#39;norm&#39;</span><span class=p>,</span> <span class=s1>&#39;gated&#39;</span><span class=p>,</span> <span class=s1>&#39;concatenated&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>irreps</span><span class=p>[</span><span class=n>name</span><span class=p>]</span> <span class=o>=</span> <span class=n>IrreducibleRepresentation</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>irrep</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                                      <span class=n>supported_nonlinearities</span><span class=o>=</span><span class=n>supported_nonlinearities</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                                      <span class=c1># character=character,</span>
</span></span><span class=line><span class=cl>                                                      <span class=c1># trivial=True,</span>
</span></span><span class=line><span class=cl>                                                      <span class=n>frequency</span><span class=o>=</span><span class=n>k</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>elif</span> <span class=n>n</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>==</span> <span class=mi>0</span> <span class=ow>and</span> <span class=n>k</span> <span class=o>==</span> <span class=nb>int</span><span class=p>(</span><span class=n>n</span><span class=o>/</span><span class=mi>2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=c1># 1 dimensional Irreducible representation (only for even order groups)</span>
</span></span><span class=line><span class=cl>        <span class=n>irrep</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>element</span><span class=p>,</span> <span class=n>k</span><span class=o>=</span><span class=n>k</span><span class=p>,</span> <span class=n>base_angle</span><span class=o>=</span><span class=n>base_angle</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=n>np</span><span class=o>.</span><span class=n>cos</span><span class=p>(</span><span class=n>k</span> <span class=o>*</span> <span class=n>element</span> <span class=o>*</span> <span class=n>base_angle</span><span class=p>)]])</span>
</span></span><span class=line><span class=cl>        <span class=n>supported_nonlinearities</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;norm&#39;</span><span class=p>,</span> <span class=s1>&#39;gated&#39;</span><span class=p>,</span> <span class=s1>&#39;concatenated&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>irreps</span><span class=p>[</span><span class=n>name</span><span class=p>]</span> <span class=o>=</span> <span class=n>IrreducibleRepresentation</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>irrep</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                                      <span class=n>supported_nonlinearities</span><span class=o>=</span><span class=n>supported_nonlinearities</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                                      <span class=n>frequency</span><span class=o>=</span><span class=n>k</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># 2 dimensional Irreducible Representations</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1># build the rotation matrix with rotation frequency &#39;frequency&#39;</span>
</span></span><span class=line><span class=cl>        <span class=n>irrep</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>element</span><span class=p>,</span> <span class=n>k</span><span class=o>=</span><span class=n>k</span><span class=p>,</span> <span class=n>base_angle</span><span class=o>=</span><span class=n>base_angle</span><span class=p>:</span> <span class=n>utils</span><span class=o>.</span><span class=n>psi</span><span class=p>(</span><span class=n>element</span> <span class=o>*</span> <span class=n>base_angle</span><span class=p>,</span> <span class=n>k</span><span class=o>=</span><span class=n>k</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>supported_nonlinearities</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;norm&#39;</span><span class=p>,</span> <span class=s1>&#39;gated&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>irreps</span><span class=p>[</span><span class=n>name</span><span class=p>]</span> <span class=o>=</span> <span class=n>IrreducibleRepresentation</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>irrep</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                                      <span class=n>supported_nonlinearities</span><span class=o>=</span><span class=n>supported_nonlinearities</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                                      <span class=n>frequency</span><span class=o>=</span><span class=n>k</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>irreps</span><span class=p>[</span><span class=n>name</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>这个<code>irrrp</code>对应的代码，通过代码的注释，可以知道，是建立当前循环群频率为 <code>k</code> 的次循环。这个时候我们跳进来，看对应 的内容。</p><p><code>assert 0 &lt;= k &lt;= self.order()//2</code>：首先的话还是老规矩，这个的话断言判断，可以分成两部分进行查看：</p><ol><li><code>0 &lt;= k</code>：确保频率 <code>k</code> 是非负整数，因为频率通常是一个非负的整数。在这里，频率表示不可约表示的特定特征，因此必须为非负整数。</li><li><code>k &lt;= self.order()//2</code>：保证频率 <code>k</code> 不超过循环群的阶数 <code>N</code> 的一半。在数学上，对于循环群的不可约表示，频率 <code>k</code> 的范围通常被限制在 <code>0</code> 到 <code>N/2</code> 之间，因此这个断言确保了频率 <code>k</code> 不会超出有效范围。</li></ol><p><img src=https://img-1312072469.cos.ap-nanjing.myqcloud.com/20231203223205.png loading=lazy></p><p>当然，<strong>第二个正确性有待考究！！！</strong></p><p><code>name = f"irrep_{k}"</code>：构建表示的名称，用于存储在 <code>self.irreps</code> 字典中。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>if</span> <span class=n>name</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>irreps</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>n</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>order</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>base_angle</span> <span class=o>=</span> <span class=mf>2.0</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>pi</span> <span class=o>/</span> <span class=n>n</span>
</span></span></code></pre></td></tr></table></div></div><p>还是一样，首先读取对应 群元素阶数，这个可以看上面的<code>order</code>的 介绍，得到<code>n=8</code>。</p><p>然后，我们创建对应的<code>base_angle</code>,这里的话 就是$\frac{2 \pi}{n}$。相当于我们现在的基本角度是 360/群 元素阶数，因为循环群中的元素是围绕一个圆周循环的，所以 <code>2.0 * np.pi / n</code> 计算出了循环群中每个元素之间的角度间隔。通过将整个圆周（<code>2.0 * np.pi</code>）分成循环群的阶数 <code>n</code> 份，可以得到每个群元素之间的平均角度间隔，这个角度间隔在表示不同群元素的线性变换中很有用。</p><p>在构建循环群的不可约表示时，这个 <code>base_angle</code> 变量被用来计算表示矩阵中角度的变换。具体地，在不同频率的不可约表示中，元素与 <code>base_angle</code> 的乘积用来确定对应元素的矩阵表示。这种方式有效地利用了循环群元素之间的角度关系来构建不同频率的表示。</p><p>然后，接着看面对应的代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl> <span class=k>if</span> <span class=n>k</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># Trivial representation</span>
</span></span><span class=line><span class=cl>    <span class=n>irrep</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>element</span><span class=p>,</span> <span class=n>identity</span><span class=o>=</span><span class=n>np</span><span class=o>.</span><span class=n>eye</span><span class=p>(</span><span class=mi>1</span><span class=p>):</span> <span class=n>identity</span>
</span></span><span class=line><span class=cl>    <span class=n>character</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>e</span><span class=p>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>    <span class=n>supported_nonlinearities</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;pointwise&#39;</span><span class=p>,</span> <span class=s1>&#39;gate&#39;</span><span class=p>,</span> <span class=s1>&#39;norm&#39;</span><span class=p>,</span> <span class=s1>&#39;gated&#39;</span><span class=p>,</span> <span class=s1>&#39;concatenated&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>irreps</span><span class=p>[</span><span class=n>name</span><span class=p>]</span> <span class=o>=</span> <span class=n>IrreducibleRepresentation</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>irrep</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                                  <span class=n>supported_nonlinearities</span><span class=o>=</span><span class=n>supported_nonlinearities</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                                  <span class=c1># character=character,</span>
</span></span><span class=line><span class=cl>                                                  <span class=c1># trivial=True,</span>
</span></span><span class=line><span class=cl>                                                  <span class=n>frequency</span><span class=o>=</span><span class=n>k</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>当 <code>k</code> 为 0 时，构建了一个平凡表示（Trivial representation），对应于单位矩阵。</p><blockquote><p>平凡表示（Trivial representation）是群论中的一个概念，指的是一个群的每个元素都被映射成一个恒等矩阵或单位矩阵。对于每个群元素，这个表示都将其映射为相同的单位矩阵。</p></blockquote><p>如果循环群的阶数 <code>n</code> 为偶数且 <code>k</code> 等于 <code>n/2</code>，构建一个一维不可约表示。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-Java data-lang=Java><span class=line><span class=cl><span class=n>elif</span><span class=w> </span><span class=n>n</span><span class=w> </span><span class=o>%</span><span class=w> </span><span class=n>2</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=n>0</span><span class=w> </span><span class=n>and</span><span class=w> </span><span class=n>k</span><span class=w> </span><span class=o>==</span><span class=w> </span><span class=kt>int</span><span class=p>(</span><span class=n>n</span><span class=o>/</span><span class=n>2</span><span class=p>):</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=err>#</span><span class=w> </span><span class=n>1</span><span class=w> </span><span class=n>dimensional</span><span class=w> </span><span class=n>Irreducible</span><span class=w> </span><span class=nf>representation</span><span class=w> </span><span class=p>(</span><span class=n>only</span><span class=w> </span><span class=k>for</span><span class=w> </span><span class=n>even</span><span class=w> </span><span class=n>order</span><span class=w> </span><span class=n>groups</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>irrep</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>lambda</span><span class=w> </span><span class=n>element</span><span class=p>,</span><span class=w> </span><span class=n>k</span><span class=o>=</span><span class=n>k</span><span class=p>,</span><span class=w> </span><span class=n>base_angle</span><span class=o>=</span><span class=n>base_angle</span><span class=p>:</span><span class=w> </span><span class=n>np</span><span class=p>.</span><span class=na>array</span><span class=p>(</span><span class=o>[[</span><span class=n>np</span><span class=p>.</span><span class=na>cos</span><span class=p>(</span><span class=n>k</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>element</span><span class=w> </span><span class=o>*</span><span class=w> </span><span class=n>base_angle</span><span class=p>)</span><span class=o>]]</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>supported_nonlinearities</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>[</span><span class=err>&#39;</span><span class=n>norm</span><span class=err>&#39;</span><span class=p>,</span><span class=w> </span><span class=err>&#39;</span><span class=n>gated</span><span class=err>&#39;</span><span class=p>,</span><span class=w> </span><span class=err>&#39;</span><span class=n>concatenated</span><span class=err>&#39;</span><span class=o>]</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=n>self</span><span class=p>.</span><span class=na>irreps</span><span class=o>[</span><span class=n>name</span><span class=o>]</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>IrreducibleRepresentation</span><span class=p>(</span><span class=n>self</span><span class=p>,</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>irrep</span><span class=p>,</span><span class=w> </span><span class=n>1</span><span class=p>,</span><span class=w> </span><span class=n>1</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                              </span><span class=n>supported_nonlinearities</span><span class=o>=</span><span class=n>supported_nonlinearities</span><span class=p>,</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>                                              </span><span class=n>frequency</span><span class=o>=</span><span class=n>k</span><span class=p>)</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>TDOO：解释对应的参数</p><p>其他情况（k=1,2,3）都会来到下面：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=c1># 2 dimensional Irreducible Representations</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># build the rotation matrix with rotation frequency &#39;frequency&#39;</span>
</span></span><span class=line><span class=cl>    <span class=n>irrep</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>element</span><span class=p>,</span> <span class=n>k</span><span class=o>=</span><span class=n>k</span><span class=p>,</span> <span class=n>base_angle</span><span class=o>=</span><span class=n>base_angle</span><span class=p>:</span> <span class=n>utils</span><span class=o>.</span><span class=n>psi</span><span class=p>(</span><span class=n>element</span> <span class=o>*</span> <span class=n>base_angle</span><span class=p>,</span> <span class=n>k</span><span class=o>=</span><span class=n>k</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>supported_nonlinearities</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;norm&#39;</span><span class=p>,</span> <span class=s1>&#39;gated&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>irreps</span><span class=p>[</span><span class=n>name</span><span class=p>]</span> <span class=o>=</span> <span class=n>IrreducibleRepresentation</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>irrep</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                                  <span class=n>supported_nonlinearities</span><span class=o>=</span><span class=n>supported_nonlinearities</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                                  <span class=n>frequency</span><span class=o>=</span><span class=n>k</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><code>lambda element, k=k, base_angle=base_angle:</code>：这定义了一个匿名函数，接受两个参数 <code>element</code>、<code>k</code> 和一个默认参数 <code>base_angle</code>。这个函数可以根据传入的 <code>element</code> 参数以及已定义的 <code>k</code> 和 <code>base_angle</code> 参数来计算结果。</li><li><code>utils.psi(element * base_angle, k=k)</code>：这是函数的返回表达式。它调用了一个名为 <code>utils.psi</code> 的函数（假设 <code>utils</code> 是一个模块或对象的名称）。此函数可能用于计算给定元素乘以基础角度（<code>element * base_angle</code>）所得的结果，然后以及给定的频率 <code>k</code> 为参数。这个函数的具体操作和实现由 <code>utils.psi</code> 定义。这个函数的目的是计算表示矩阵的元素。</li></ul><p>这里需要简单看一眼 psi 这个函数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>psi</span><span class=p>(</span><span class=n>theta</span><span class=p>:</span> <span class=nb>float</span><span class=p>,</span> <span class=n>k</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>1</span><span class=p>,</span> <span class=n>gamma</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>0.</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=sa>r</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Rotation matrix corresponding to the angle :math:`k \theta + \gamma`.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>x</span> <span class=o>=</span> <span class=n>k</span> <span class=o>*</span> <span class=n>theta</span> <span class=o>+</span> <span class=n>gamma</span>
</span></span><span class=line><span class=cl>    <span class=n>c</span><span class=p>,</span> <span class=n>s</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>cos</span><span class=p>(</span><span class=n>x</span><span class=p>),</span> <span class=n>np</span><span class=o>.</span><span class=n>sin</span><span class=p>(</span><span class=n>x</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>(([</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>c</span><span class=p>,</span> <span class=o>-</span><span class=n>s</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>[</span><span class=n>s</span><span class=p>,</span>  <span class=n>c</span><span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=p>]))</span>
</span></span></code></pre></td></tr></table></div></div><p>现在举一个例子，假设我们现在$k = 1, elements= [0,1,2,3,4,5,6,7]$，这个时候，对应计算结果应该出来 8 个。手写出来对应的 例子，如下：</p><p><img src=https://img-1312072469.cos.ap-nanjing.myqcloud.com/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20231203094929.jpg loading=lazy alt=微信图片_20231203094929></p><p><strong>然后，在后面使用时对里面的值有一个操作，这里的话还有一个疑问，后面那句话不是已经使用了嘛，为什么不是这个时候进行初始化？</strong> 先看后面程序，等回头在解决这个问题。</p><p>然后，来到最后一种情况，相当于现在是 n 是偶数并 k=n/2 是才会进入。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>elif</span> <span class=n>n</span> <span class=o>%</span> <span class=mi>2</span> <span class=o>==</span> <span class=mi>0</span> <span class=ow>and</span> <span class=n>k</span> <span class=o>==</span> <span class=nb>int</span><span class=p>(</span><span class=n>n</span><span class=o>/</span><span class=mi>2</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=c1># 1 dimensional Irreducible representation (only for even order groups)</span>
</span></span><span class=line><span class=cl>    <span class=n>irrep</span> <span class=o>=</span> <span class=k>lambda</span> <span class=n>element</span><span class=p>,</span> <span class=n>k</span><span class=o>=</span><span class=n>k</span><span class=p>,</span> <span class=n>base_angle</span><span class=o>=</span><span class=n>base_angle</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>array</span><span class=p>([[</span><span class=n>np</span><span class=o>.</span><span class=n>cos</span><span class=p>(</span><span class=n>k</span> <span class=o>*</span> <span class=n>element</span> <span class=o>*</span> <span class=n>base_angle</span><span class=p>)]])</span>
</span></span><span class=line><span class=cl>    <span class=n>supported_nonlinearities</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;norm&#39;</span><span class=p>,</span> <span class=s1>&#39;gated&#39;</span><span class=p>,</span> <span class=s1>&#39;concatenated&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=bp>self</span><span class=o>.</span><span class=n>irreps</span><span class=p>[</span><span class=n>name</span><span class=p>]</span> <span class=o>=</span> <span class=n>IrreducibleRepresentation</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>irrep</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                                  <span class=n>supported_nonlinearities</span><span class=o>=</span><span class=n>supported_nonlinearities</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                                  <span class=n>frequency</span><span class=o>=</span><span class=n>k</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>跟上面的进行对比，这个区别就是里面创建的矩阵不一样了，成了一个$1 \times 1$的矩阵。</p><p>上面这个函数疑问重重，为什么一个频率有 7 个表示，然后他们后面会进行什么操作，这些都要看下面的代码，然后才能进行解答。</p><p>ok，现在看下面的代码，回答上面的问题。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=c1># Build all Representations</span>
</span></span><span class=line><span class=cl><span class=c1># add all the irreps to the set of representations already built for this group</span>
</span></span><span class=line><span class=cl><span class=bp>self</span><span class=o>.</span><span class=n>representations</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=o>**</span><span class=bp>self</span><span class=o>.</span><span class=n>irreps</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=c1># build the regular representation</span>
</span></span><span class=line><span class=cl><span class=bp>self</span><span class=o>.</span><span class=n>representations</span><span class=p>[</span><span class=s1>&#39;regular&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>regular_representation</span>
</span></span><span class=line><span class=cl><span class=bp>self</span><span class=o>.</span><span class=n>representations</span><span class=p>[</span><span class=s1>&#39;regular&#39;</span><span class=p>]</span><span class=o>.</span><span class=n>supported_nonlinearities</span><span class=o>.</span><span class=n>add</span><span class=p>(</span><span class=s1>&#39;vectorfield&#39;</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>如果说现在已经有了不可约表示，直接更新。</p><p>如果说不存在，这个是将会将群与<code>rugular</code>的键与<code>self.regular_representation</code>关联起来，存储在<code>slef.reular_representation</code>中。</p><p>下面的话看这个里面的代码，是<strong>重头戏</strong>：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>regular_representation</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>e2cnn</span><span class=o>.</span><span class=n>group</span><span class=o>.</span><span class=n>Representation</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=sa>r</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    Builds the regular representation of the group if the group has a *finite* number of elements;
</span></span></span><span class=line><span class=cl><span class=s2>    returns ``None`` otherwise.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    The regular representation of a finite group :math:`G` acts on a vector space :math:`\R^{|G|}` by permuting its
</span></span></span><span class=line><span class=cl><span class=s2>    axes.
</span></span></span><span class=line><span class=cl><span class=s2>    Specifically, associating each axis :math:`e_g` of :math:`\R^{|G|}` to an element :math:`g \in G`, the
</span></span></span><span class=line><span class=cl><span class=s2>    representation of an element :math:`\tilde</span><span class=si>{g}</span><span class=s2>\in G` is a permutation matrix which maps :math:`e_g` to
</span></span></span><span class=line><span class=cl><span class=s2>    :math:`e_{\tilde</span><span class=si>{g}</span><span class=s2>g}`.
</span></span></span><span class=line><span class=cl><span class=s2>    For instance, the regular representation of the group :math:`C_4` with elements
</span></span></span><span class=line><span class=cl><span class=s2>    :math:`\{r^k | k=0,\dots,3 \}` is instantiated by:
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    +-----------------------------------+------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------+
</span></span></span><span class=line><span class=cl><span class=s2>    |    :math:`g`                      |          :math:`e`                                                                                         |          :math:`r`                                                                                         |        :math:`r^2`                                                                                         |        :math:`r^3`                                                                                         |
</span></span></span><span class=line><span class=cl><span class=s2>    +===================================+============================================================================================================+============================================================================================================+============================================================================================================+============================================================================================================+
</span></span></span><span class=line><span class=cl><span class=s2>    |  :math:`\rho_\text</span><span class=si>{reg}</span><span class=s2>^</span><span class=si>{C_4}</span><span class=s2>(g)` | :math:`\begin</span><span class=si>{bmatrix}</span><span class=s2> 1 &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; 1 &amp; 0 &amp; 0 \\  0 &amp; 0 &amp; 1 &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; 1 \\ \end</span><span class=si>{bmatrix}</span><span class=s2>` | :math:`\begin</span><span class=si>{bmatrix}</span><span class=s2> 0 &amp; 0 &amp; 0 &amp; 1 \\ 1 &amp; 0 &amp; 0 &amp; 0 \\  0 &amp; 1 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 1 &amp; 0 \\ \end</span><span class=si>{bmatrix}</span><span class=s2>` | :math:`\begin</span><span class=si>{bmatrix}</span><span class=s2> 0 &amp; 0 &amp; 1 &amp; 0 \\ 0 &amp; 0 &amp; 0 &amp; 1 \\  1 &amp; 0 &amp; 0 &amp; 0 \\ 0 &amp; 1 &amp; 0 &amp; 0 \\ \end</span><span class=si>{bmatrix}</span><span class=s2>` | :math:`\begin</span><span class=si>{bmatrix}</span><span class=s2> 0 &amp; 1 &amp; 0 &amp; 0 \\ 0 &amp; 0 &amp; 1 &amp; 0 \\  0 &amp; 0 &amp; 0 &amp; 1 \\ 1 &amp; 0 &amp; 0 &amp; 0 \\ \end</span><span class=si>{bmatrix}</span><span class=s2>` |
</span></span></span><span class=line><span class=cl><span class=s2>    +-----------------------------------+------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------+------------------------------------------------------------------------------------------------------------+
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    A vector :math:`v=\sum_g v_g e_g` in :math:`\R^{|G|}` can be interpreted as a scalar function
</span></span></span><span class=line><span class=cl><span class=s2>    :math:`v:G \to \R,\, g \mapsto v_g` on :math:`G`.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Returns:
</span></span></span><span class=line><span class=cl><span class=s2>        the regular representation of the group
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>order</span><span class=p>()</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Regular representation is supported only for finite groups but &#34;</span>
</span></span><span class=line><span class=cl>                         <span class=sa>f</span><span class=s2>&#34;the group </span><span class=si>{</span><span class=bp>self</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2> has an infinite number of elements&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=s2>&#34;regular&#34;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>representations</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>irreps</span><span class=p>,</span> <span class=n>change_of_basis</span><span class=p>,</span> <span class=n>change_of_basis_inv</span> <span class=o>=</span> <span class=n>e2cnn</span><span class=o>.</span><span class=n>group</span><span class=o>.</span><span class=n>representation</span><span class=o>.</span><span class=n>build_regular_representation</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>supported_nonlinearities</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;pointwise&#39;</span><span class=p>,</span> <span class=s1>&#39;norm&#39;</span><span class=p>,</span> <span class=s1>&#39;gated&#39;</span><span class=p>,</span> <span class=s1>&#39;concatenated&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>representations</span><span class=p>[</span><span class=s2>&#34;regular&#34;</span><span class=p>]</span> <span class=o>=</span> <span class=n>e2cnn</span><span class=o>.</span><span class=n>group</span><span class=o>.</span><span class=n>Representation</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                                                         <span class=s2>&#34;regular&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                                                         <span class=p>[</span><span class=n>r</span><span class=o>.</span><span class=n>name</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>irreps</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                                                                         <span class=n>change_of_basis</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                                                         <span class=n>supported_nonlinearities</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                                                         <span class=n>change_of_basis_inv</span><span class=o>=</span><span class=n>change_of_basis_inv</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                                                                         <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>representations</span><span class=p>[</span><span class=s2>&#34;regular&#34;</span><span class=p>]</span>
</span></span></code></pre></td></tr></table></div></div><p>如果说现在是有限循环群，这段代码将构建群的正则表示。</p><p>然后，我们看到里面<code>irreps</code>这个变量将会进行创建，执行的是这个语句：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>irreps</span><span class=p>,</span> <span class=n>change_of_basis</span><span class=p>,</span> <span class=n>change_of_basis_inv</span> <span class=o>=</span> <span class=n>e2cnn</span><span class=o>.</span><span class=n>group</span><span class=o>.</span><span class=n>representation</span><span class=o>.</span><span class=n>build_regular_representation</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>那么下面，需要看<code>build_regular_representation</code>这个函数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>build_regular_representation</span><span class=p>(</span><span class=n>group</span><span class=p>:</span> <span class=n>e2cnn</span><span class=o>.</span><span class=n>group</span><span class=o>.</span><span class=n>Group</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>List</span><span class=p>[</span><span class=n>e2cnn</span><span class=o>.</span><span class=n>group</span><span class=o>.</span><span class=n>IrreducibleRepresentation</span><span class=p>],</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>,</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>    <span class=sa>r</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    Build the regular representation of the input ``group``.
</span></span></span><span class=line><span class=cl><span class=s2>    As the regular representation has size equal to the number of elements in the group, only
</span></span></span><span class=line><span class=cl><span class=s2>    finite groups are accepted.
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    Args:
</span></span></span><span class=line><span class=cl><span class=s2>        group (Group): the group whose representations has to be built
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Returns:
</span></span></span><span class=line><span class=cl><span class=s2>        a tuple containing the list of irreps, the change of basis and the inverse change of basis of
</span></span></span><span class=line><span class=cl><span class=s2>        the regular representation
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>group</span><span class=o>.</span><span class=n>order</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>group</span><span class=o>.</span><span class=n>elements</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>group</span><span class=o>.</span><span class=n>elements</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>size</span> <span class=o>=</span> <span class=n>group</span><span class=o>.</span><span class=n>order</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>index</span> <span class=o>=</span> <span class=p>{</span><span class=n>e</span><span class=p>:</span> <span class=n>i</span> <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>e</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>group</span><span class=o>.</span><span class=n>elements</span><span class=p>)}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>representation</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=n>character</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>e</span> <span class=ow>in</span> <span class=n>group</span><span class=o>.</span><span class=n>elements</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># print(index[e], e)</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>size</span><span class=p>,</span> <span class=n>size</span><span class=p>),</span> <span class=n>dtype</span><span class=o>=</span><span class=nb>float</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>g</span> <span class=ow>in</span> <span class=n>group</span><span class=o>.</span><span class=n>elements</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>eg</span> <span class=o>=</span> <span class=n>group</span><span class=o>.</span><span class=n>combine</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=n>g</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=n>i</span> <span class=o>=</span> <span class=n>index</span><span class=p>[</span><span class=n>g</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=n>j</span> <span class=o>=</span> <span class=n>index</span><span class=p>[</span><span class=n>eg</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>r</span><span class=p>[</span><span class=n>j</span><span class=p>,</span> <span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=mf>1.0</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>representation</span><span class=p>[</span><span class=n>e</span><span class=p>]</span> <span class=o>=</span> <span class=n>r</span>
</span></span><span class=line><span class=cl>        <span class=c1># the character maps an element to the trace of its representation</span>
</span></span><span class=line><span class=cl>        <span class=n>character</span><span class=p>[</span><span class=n>e</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>trace</span><span class=p>(</span><span class=n>r</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># compute the multiplicities of the irreps from the dot product between</span>
</span></span><span class=line><span class=cl>    <span class=c1># their characters and the character of the representation</span>
</span></span><span class=line><span class=cl>    <span class=n>irreps</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=n>multiplicities</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>irrep_name</span><span class=p>,</span> <span class=n>irrep</span> <span class=ow>in</span> <span class=n>group</span><span class=o>.</span><span class=n>irreps</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=c1># for each irrep</span>
</span></span><span class=line><span class=cl>        <span class=n>multiplicity</span> <span class=o>=</span> <span class=mf>0.0</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>        <span class=c1># compute the inner product with the representation&#39;s character</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>element</span><span class=p>,</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>character</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=n>multiplicity</span> <span class=o>+=</span> <span class=n>char</span> <span class=o>*</span> <span class=n>irrep</span><span class=o>.</span><span class=n>character</span><span class=p>(</span><span class=n>group</span><span class=o>.</span><span class=n>inverse</span><span class=p>(</span><span class=n>element</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>        <span class=n>multiplicity</span> <span class=o>/=</span> <span class=nb>len</span><span class=p>(</span><span class=n>character</span><span class=p>)</span> <span class=o>*</span> <span class=n>irrep</span><span class=o>.</span><span class=n>sum_of_squares_constituents</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>        <span class=c1># the result has to be an integer</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=n>math</span><span class=o>.</span><span class=n>isclose</span><span class=p>(</span><span class=n>multiplicity</span><span class=p>,</span> <span class=nb>round</span><span class=p>(</span><span class=n>multiplicity</span><span class=p>),</span> <span class=n>abs_tol</span><span class=o>=</span><span class=mf>1e-9</span><span class=p>),</span> \
</span></span><span class=line><span class=cl>            <span class=s2>&#34;Multiplicity of irrep </span><span class=si>%s</span><span class=s2> is not an integer: </span><span class=si>%f</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=n>irrep_name</span><span class=p>,</span> <span class=n>multiplicity</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># print(irrep_name, multiplicity)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>multiplicity</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=nb>round</span><span class=p>(</span><span class=n>multiplicity</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>irreps</span> <span class=o>+=</span> <span class=p>[</span><span class=n>irrep</span><span class=p>]</span><span class=o>*</span><span class=n>multiplicity</span>
</span></span><span class=line><span class=cl>        <span class=n>multiplicities</span> <span class=o>+=</span> <span class=p>[(</span><span class=n>irrep</span><span class=p>,</span> <span class=n>multiplicity</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>P</span> <span class=o>=</span> <span class=n>directsum</span><span class=p>(</span><span class=n>irreps</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s2>&#34;irreps&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>v</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>size</span><span class=p>,</span> <span class=mi>1</span><span class=p>),</span> <span class=n>dtype</span><span class=o>=</span><span class=nb>float</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>irr</span><span class=p>,</span> <span class=n>m</span> <span class=ow>in</span> <span class=n>multiplicities</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=n>irr</span><span class=o>.</span><span class=n>size</span> <span class=o>&gt;=</span> <span class=n>m</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span> <span class=o>=</span> <span class=n>irr</span><span class=o>.</span><span class=n>size</span>
</span></span><span class=line><span class=cl>        <span class=n>v</span><span class=p>[</span><span class=n>p</span><span class=p>:</span><span class=n>p</span><span class=o>+</span><span class=n>m</span><span class=o>*</span><span class=n>s</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>eye</span><span class=p>(</span><span class=n>m</span><span class=p>,</span> <span class=n>s</span><span class=p>)</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span> <span class=o>+=</span> <span class=n>m</span><span class=o>*</span><span class=n>s</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=n>change_of_basis</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>size</span><span class=p>,</span> <span class=n>size</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>np</span><span class=o>.</span><span class=n>set_printoptions</span><span class=p>(</span><span class=n>precision</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span> <span class=n>threshold</span><span class=o>=</span><span class=mi>10</span><span class=o>*</span><span class=n>size</span><span class=o>**</span><span class=mi>2</span><span class=p>,</span> <span class=n>suppress</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>25</span><span class=o>*</span><span class=n>size</span> <span class=o>+</span> <span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>e</span> <span class=ow>in</span> <span class=n>group</span><span class=o>.</span><span class=n>elements</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>ev</span> <span class=o>=</span> <span class=n>P</span><span class=p>(</span><span class=n>e</span><span class=p>)</span> <span class=o>@</span> <span class=n>v</span>
</span></span><span class=line><span class=cl>        <span class=n>change_of_basis</span><span class=p>[</span><span class=n>index</span><span class=p>[</span><span class=n>e</span><span class=p>],</span> <span class=p>:]</span> <span class=o>=</span> <span class=n>ev</span><span class=o>.</span><span class=n>T</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>change_of_basis</span> <span class=o>/=</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># the computed change of basis is an orthonormal matrix</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># change_of_basis_inv = sp.linalg.inv(change_of_basis)</span>
</span></span><span class=line><span class=cl>    <span class=n>change_of_basis_inv</span> <span class=o>=</span> <span class=n>change_of_basis</span><span class=o>.</span><span class=n>T</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>irreps</span><span class=p>,</span> <span class=n>change_of_basis</span><span class=p>,</span> <span class=n>change_of_basis_inv</span>
</span></span></code></pre></td></tr></table></div></div><p>这个函数其实是核心中的核心，这个就是将每个频率进行相加，然后得到一个值。下面将这个进行逐行解析。</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>assert</span> <span class=n>group</span><span class=o>.</span><span class=n>order</span><span class=p>()</span> <span class=o>&gt;</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=k>assert</span> <span class=n>group</span><span class=o>.</span><span class=n>elements</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span> <span class=ow>and</span> <span class=nb>len</span><span class=p>(</span><span class=n>group</span><span class=o>.</span><span class=n>elements</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>size</span> <span class=o>=</span> <span class=n>group</span><span class=o>.</span><span class=n>order</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>index</span> <span class=o>=</span> <span class=p>{</span><span class=n>e</span><span class=p>:</span> <span class=n>i</span> <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=n>e</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=n>group</span><span class=o>.</span><span class=n>elements</span><span class=p>)}</span>
</span></span></code></pre></td></tr></table></div></div><p>这个还是老规矩，首先先判断，然后设置群的结束，以及对应的索引号。然后创建 index 的字典。</p><ul><li><code>group.elements</code>：这个部分可能是一个群（group）对象或类中的属性，其中包含了群的元素。</li><li><code>enumerate(group.elements)</code>：<code>enumerate()</code> 函数用于迭代一个可迭代对象（比如列表、元组等），并返回索引值和对应的元素。这里对群中的元素进行了枚举，<code>i</code> 是索引，<code>e</code> 是群中的元素。</li><li><code>{e: i for i, e in enumerate(group.elements)}</code>：这是一个字典推导式。它遍历了 <code>enumerate(group.elements)</code> 返回的枚举对象，对每个元素创建了一个键值对。字典的键是群中的元素 <code>e</code>，而值是它们在群中的索引 <code>i</code>。</li></ul><p>在本文的情况下 index 的值就是<code>{0: 0, 1: 1, 2: 2, 3: 3, 4: 4, 5: 5, 6: 6, 7: 7}</code></p><p>然后看下面的代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>for</span> <span class=n>e</span> <span class=ow>in</span> <span class=n>group</span><span class=o>.</span><span class=n>elements</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=n>index</span><span class=p>[</span><span class=n>e</span><span class=p>],</span> <span class=n>e</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>r</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>size</span><span class=p>,</span> <span class=n>size</span><span class=p>),</span> <span class=n>dtype</span><span class=o>=</span><span class=nb>float</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>g</span> <span class=ow>in</span> <span class=n>group</span><span class=o>.</span><span class=n>elements</span><span class=p>:</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>eg</span> <span class=o>=</span> <span class=n>group</span><span class=o>.</span><span class=n>combine</span><span class=p>(</span><span class=n>e</span><span class=p>,</span> <span class=n>g</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>i</span> <span class=o>=</span> <span class=n>index</span><span class=p>[</span><span class=n>g</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>j</span> <span class=o>=</span> <span class=n>index</span><span class=p>[</span><span class=n>eg</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=p>[</span><span class=n>j</span><span class=p>,</span> <span class=n>i</span><span class=p>]</span> <span class=o>=</span> <span class=mf>1.0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>representation</span><span class=p>[</span><span class=n>e</span><span class=p>]</span> <span class=o>=</span> <span class=n>r</span>
</span></span><span class=line><span class=cl>    <span class=c1># the character maps an element to the trace of its representation</span>
</span></span><span class=line><span class=cl>    <span class=n>character</span><span class=p>[</span><span class=n>e</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>trace</span><span class=p>(</span><span class=n>r</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>这段代码首先先遍历里面的元素，创建一个大小为 (size,size) 大小的二维数组<code>r</code>。</p><p>在每个元素 <code>e</code> 的循环内，这段代码嵌套了一个循环，遍历群 <code>group</code> 中的每个元素 <code>g</code>。将对应的群<code>e</code>和<code>g</code>结合起来，创建一个新的群元素<code>eg</code>。</p><p><code>i = index[g]</code> 和 <code>j = index[eg]</code>：这两行代码分别获取了群元素 <code>g</code> 和 <code>eg</code> 在 <code>index</code> 字典中的索引值，即它们在表示矩阵 <code>r</code> 中对应的位置。</p><p><code>r[j, i] = 1.0</code>：这行代码将表示矩阵 <code>r</code> 中的位置 <code>(j, i)</code>（根据群元素 <code>eg</code> 和 <code>g</code> 的索引值计算得到）的元素设置为 1.0。这是表示矩阵中的一个元素，用于表示群操作后的结果。</p><p><code>representation[e] = r</code>：将表示矩阵 <code>r</code> 存储到表示字典 <code>representation</code> 中，其中键是群元素 <code>e</code>。</p><p><code>character[e] = np.trace(r)</code>：这行代码计算了表示矩阵 <code>r</code> 的迹（trace），并将其存储在字符（character）字典 <code>character</code> 中，键是群元素 <code>e</code>。在群论中，表示的迹（trace）通常被称为字符（character），它是表示理论中的一个重要性质之一。</p><p>还是从一个例子出发，这里的话还使用对应的<code>e=0</code>，<code>g= 0,1,2,3,4,5,6,7</code>这种情况。</p><p>这个时候，<code>eg=0,1,2,3,4,5,6,7</code>，在遍历完成之后，对应的<code>r</code>矩阵应该就是$8 \times 8$的单位矩阵，然后此时 representation 应该就是 (0) 位置是 1，其他位置都是 0。character[0]应该是 矩阵的迹，是 8。</p><p><img src=https://img-1312072469.cos.ap-nanjing.myqcloud.com/image-20231203103758920.png loading=lazy alt=image-20231203103758920></p><p><img src=https://img-1312072469.cos.ap-nanjing.myqcloud.com/image-20231203103830708.png loading=lazy alt=image-20231203103830708></p><p><img src=https://img-1312072469.cos.ap-nanjing.myqcloud.com/image-20231203103854946.png loading=lazy alt=image-20231203103854946></p><p>以此类推，创建完对应的数组。</p><p>然后接着看下面的代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>irreps</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=n>multiplicities</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>irrep_name</span><span class=p>,</span> <span class=n>irrep</span> <span class=ow>in</span> <span class=n>group</span><span class=o>.</span><span class=n>irreps</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=c1># for each irrep</span>
</span></span><span class=line><span class=cl>    <span class=n>multiplicity</span> <span class=o>=</span> <span class=mf>0.0</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># compute the inner product with the representation&#39;s character</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>element</span><span class=p>,</span> <span class=n>char</span> <span class=ow>in</span> <span class=n>character</span><span class=o>.</span><span class=n>items</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>multiplicity</span> <span class=o>+=</span> <span class=n>char</span> <span class=o>*</span> <span class=n>irrep</span><span class=o>.</span><span class=n>character</span><span class=p>(</span><span class=n>group</span><span class=o>.</span><span class=n>inverse</span><span class=p>(</span><span class=n>element</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>multiplicity</span> <span class=o>/=</span> <span class=nb>len</span><span class=p>(</span><span class=n>character</span><span class=p>)</span> <span class=o>*</span> <span class=n>irrep</span><span class=o>.</span><span class=n>sum_of_squares_constituents</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1># the result has to be an integer</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>math</span><span class=o>.</span><span class=n>isclose</span><span class=p>(</span><span class=n>multiplicity</span><span class=p>,</span> <span class=nb>round</span><span class=p>(</span><span class=n>multiplicity</span><span class=p>),</span> <span class=n>abs_tol</span><span class=o>=</span><span class=mf>1e-9</span><span class=p>),</span> \
</span></span><span class=line><span class=cl>        <span class=s2>&#34;Multiplicity of irrep </span><span class=si>%s</span><span class=s2> is not an integer: </span><span class=si>%f</span><span class=s2>&#34;</span> <span class=o>%</span> <span class=p>(</span><span class=n>irrep_name</span><span class=p>,</span> <span class=n>multiplicity</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=c1># print(irrep_name, multiplicity)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>multiplicity</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=nb>round</span><span class=p>(</span><span class=n>multiplicity</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>irreps</span> <span class=o>+=</span> <span class=p>[</span><span class=n>irrep</span><span class=p>]</span><span class=o>*</span><span class=n>multiplicity</span>
</span></span><span class=line><span class=cl>    <span class=n>multiplicities</span> <span class=o>+=</span> <span class=p>[(</span><span class=n>irrep</span><span class=p>,</span> <span class=n>multiplicity</span><span class=p>)]</span>
</span></span></code></pre></td></tr></table></div></div><p>计算群的不可约表示（irreducible representations）的重复数量（multiplicities），并将结果存储在 <code>irreps</code> 和 <code>multiplicities</code> 中。下面逐行分析对应的代码。</p><p>首先的话创建对应的变量进行存储。</p><p><code>for irrep_name, irrep in group.irreps.items():</code>：这段代码遍历了群 <code>group</code> 的不可约表示字典（<code>group.irreps</code>）中的每一个不可约表示，其中 <code>irrep_name</code> 是表示的名称，<code>irrep</code> 是表示对象。</p><p>group.irreps.items() 就是我们 上面创建好的群元素。</p><p><code>for element, char in character.items():</code>：这段代码遍历了字符（character）字典 <code>character</code> 中的每个群元素和对应的字符值（character value）。</p><p><code>multiplicity += char * irrep.character(group.inverse(element))</code>：在每个不可约表示 <code>irrep</code> 的循环内，计算了该不可约表示与表示对应群元素的字符的内积（inner product）。这个内积计算用于确定表示的重复次数。</p><p><code>multiplicity /= len(character) * irrep.sum_of_squares_constituents</code>：在内积计算之后，对结果进行了归一化，除以表示的元素数乘以不可约表示的总元素平方和。</p><p><code>assert math.isclose(multiplicity, round(multiplicity), abs_tol=1e-9)</code>：这行代码检查 <code>multiplicity</code> 是否接近于整数，如果不是，则会触发断言错误。</p><p><code>multiplicity = int(round(multiplicity))</code>：将 <code>multiplicity</code> 舍入为最接近的整数值，确保它是整数。</p><p><code>irreps += [irrep]*multiplicity</code> 和 <code>multiplicities += [(irrep, multiplicity)]</code>：将不可约表示 <code>irrep</code> 重复 <code>multiplicity</code> 次添加到 <code>irreps</code> 列表中，并将表示和其重复次数的元组添加到 <code>multiplicities</code> 列表中。</p><p>然后看下面的代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span><span class=lnt>8
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>P</span> <span class=o>=</span> <span class=n>directsum</span><span class=p>(</span><span class=n>irreps</span><span class=p>,</span> <span class=n>name</span><span class=o>=</span><span class=s2>&#34;irreps&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>v</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>size</span><span class=p>,</span> <span class=mi>1</span><span class=p>),</span> <span class=n>dtype</span><span class=o>=</span><span class=nb>float</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>irr</span><span class=p>,</span> <span class=n>m</span> <span class=ow>in</span> <span class=n>multiplicities</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>irr</span><span class=o>.</span><span class=n>size</span> <span class=o>&gt;=</span> <span class=n>m</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=n>irr</span><span class=o>.</span><span class=n>size</span>
</span></span><span class=line><span class=cl>    <span class=n>v</span><span class=p>[</span><span class=n>p</span><span class=p>:</span><span class=n>p</span><span class=o>+</span><span class=n>m</span><span class=o>*</span><span class=n>s</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>eye</span><span class=p>(</span><span class=n>m</span><span class=p>,</span> <span class=n>s</span><span class=p>)</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>+=</span> <span class=n>m</span><span class=o>*</span><span class=n>s</span>
</span></span></code></pre></td></tr></table></div></div><p><code>directsum(irreps, name="irreps")</code>：这里使用了一个名为 <code>directsum</code> 的函数，它的目的是将不可约表示列表 <code>irreps</code> 中的不可约表示按照其给定的重数信息相加，构建一个直和表示 <code>P</code>。</p><p>看<code>directsum</code>这个函数：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=k>def</span> <span class=nf>directsum</span><span class=p>(</span><span class=n>reprs</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>e2cnn</span><span class=o>.</span><span class=n>group</span><span class=o>.</span><span class=n>Representation</span><span class=p>],</span>
</span></span><span class=line><span class=cl>              <span class=n>change_of_basis</span><span class=p>:</span> <span class=n>np</span><span class=o>.</span><span class=n>ndarray</span> <span class=o>=</span> <span class=kc>None</span><span class=p>,</span>
</span></span><span class=line><span class=cl>              <span class=n>name</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>              <span class=p>)</span> <span class=o>-&gt;</span> <span class=n>e2cnn</span><span class=o>.</span><span class=n>group</span><span class=o>.</span><span class=n>Representation</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=sa>r</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Compute the *direct sum* of a list of representations of a group.
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    The direct sum of two representations is defined as follow:
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    .. math::
</span></span></span><span class=line><span class=cl><span class=s2>        \rho_1(g) \oplus \rho_2(g) = \begin</span><span class=si>{bmatrix}</span><span class=s2> \rho_1(g) &amp; 0 \\ 0 &amp; \rho_2(g) \end</span><span class=si>{bmatrix}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    This can be generalized to multiple representations as:
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>    .. math::
</span></span></span><span class=line><span class=cl><span class=s2>        \bigoplus_{i=1}^I \rho_i(g) = (\rho_1(g) \oplus (\rho_2(g) \oplus (\rho_3(g) \oplus \dots = \begin</span><span class=si>{bmatrix}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            \rho_1(g) &amp;         0 &amp;  \dots &amp;      0 \\
</span></span></span><span class=line><span class=cl><span class=s2>                    0 &amp; \rho_2(g) &amp;  \dots &amp; \vdots \\
</span></span></span><span class=line><span class=cl><span class=s2>               \vdots &amp;    \vdots &amp; \ddots &amp;      0 \\
</span></span></span><span class=line><span class=cl><span class=s2>                    0 &amp;     \dots &amp;      0 &amp; \rho_I(g) \\
</span></span></span><span class=line><span class=cl><span class=s2>        \end</span><span class=si>{bmatrix}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    .. note::
</span></span></span><span class=line><span class=cl><span class=s2>        All the input representations need to belong to the same group.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Args:
</span></span></span><span class=line><span class=cl><span class=s2>        reprs (list): the list of representations to sum.
</span></span></span><span class=line><span class=cl><span class=s2>        change_of_basis (~numpy.ndarray, optional): an invertible square matrix to use as change of basis after computing the direct sum.
</span></span></span><span class=line><span class=cl><span class=s2>                By default (``None``), an identity matrix is used, such that only the direct sum is evaluated.
</span></span></span><span class=line><span class=cl><span class=s2>        name (str, optional): a name for the new representation.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Returns:
</span></span></span><span class=line><span class=cl><span class=s2>        the direct sum
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>group</span> <span class=o>=</span> <span class=n>reprs</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>group</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>reprs</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=k>assert</span> <span class=n>group</span> <span class=o>==</span> <span class=n>r</span><span class=o>.</span><span class=n>group</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>name</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>name</span> <span class=o>=</span> <span class=s2>&#34;_&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>([</span><span class=sa>f</span><span class=s2>&#34;[</span><span class=si>{</span><span class=n>r</span><span class=o>.</span><span class=n>name</span><span class=si>}</span><span class=s2>]&#34;</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>reprs</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>irreps</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>reprs</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>irreps</span> <span class=o>+=</span> <span class=n>r</span><span class=o>.</span><span class=n>irreps</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>size</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>([</span><span class=n>r</span><span class=o>.</span><span class=n>size</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>reprs</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>cob</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>size</span><span class=p>,</span> <span class=n>size</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>cob_inv</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>size</span><span class=p>,</span> <span class=n>size</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>    <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>reprs</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>cob</span><span class=p>[</span><span class=n>p</span><span class=p>:</span><span class=n>p</span> <span class=o>+</span> <span class=n>r</span><span class=o>.</span><span class=n>size</span><span class=p>,</span> <span class=n>p</span><span class=p>:</span><span class=n>p</span> <span class=o>+</span> <span class=n>r</span><span class=o>.</span><span class=n>size</span><span class=p>]</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>change_of_basis</span>
</span></span><span class=line><span class=cl>        <span class=n>cob_inv</span><span class=p>[</span><span class=n>p</span><span class=p>:</span><span class=n>p</span> <span class=o>+</span> <span class=n>r</span><span class=o>.</span><span class=n>size</span><span class=p>,</span> <span class=n>p</span><span class=p>:</span><span class=n>p</span> <span class=o>+</span> <span class=n>r</span><span class=o>.</span><span class=n>size</span><span class=p>]</span> <span class=o>=</span> <span class=n>r</span><span class=o>.</span><span class=n>change_of_basis_inv</span>
</span></span><span class=line><span class=cl>        <span class=n>p</span> <span class=o>+=</span> <span class=n>r</span><span class=o>.</span><span class=n>size</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>change_of_basis</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>change_of_basis</span> <span class=o>=</span> <span class=n>change_of_basis</span> <span class=o>@</span> <span class=n>cob</span>
</span></span><span class=line><span class=cl>        <span class=n>change_of_basis_inv</span> <span class=o>=</span> <span class=n>sp</span><span class=o>.</span><span class=n>linalg</span><span class=o>.</span><span class=n>inv</span><span class=p>(</span><span class=n>change_of_basis</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>change_of_basis</span> <span class=o>=</span> <span class=n>cob</span>
</span></span><span class=line><span class=cl>        <span class=n>change_of_basis_inv</span> <span class=o>=</span> <span class=n>cob_inv</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>supported_nonlinearities</span> <span class=o>=</span> <span class=nb>set</span><span class=o>.</span><span class=n>intersection</span><span class=p>(</span><span class=o>*</span><span class=p>[</span><span class=n>r</span><span class=o>.</span><span class=n>supported_nonlinearities</span> <span class=k>for</span> <span class=n>r</span> <span class=ow>in</span> <span class=n>reprs</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>Representation</span><span class=p>(</span><span class=n>group</span><span class=p>,</span> <span class=n>name</span><span class=p>,</span> <span class=n>irreps</span><span class=p>,</span> <span class=n>change_of_basis</span><span class=p>,</span> <span class=n>supported_nonlinearities</span><span class=p>,</span> <span class=n>change_of_basis_inv</span><span class=o>=</span><span class=n>change_of_basis_inv</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>这个函数作用是计算群的代表列表的直积。两个数的直积可以表示成：
$$
\rho_1(g) \oplus \rho_2(g) = \begin{bmatrix} \rho_1(g) & 0 \ 0 & \rho_2(g) \end{bmatrix}
$$
这可以推广为多种表示形式：
$$
\bigoplus_{i=1}^I \rho_i(g) = (\rho_1(g) \oplus (\rho_2(g) \oplus (\rho_3(g) \oplus \dots = \begin{bmatrix}
\rho_1(g) & 0 & \dots & 0 \
0 & \rho_2(g) & \dots & \vdots \
\vdots & \vdots & \ddots & 0 \
0 & \dots & 0 & \rho_I(g) \
\end{bmatrix}
$$
里面拿到很多变量进行直积操作，相当于矩阵的拼接以及填充，里面没有什么好讲的。</p><p>然后，我们现在讲不可约群 进行直接操作，命名成<code>irreps</code>，接下来将创建一个大小为 <code>(size, 1)</code> 的全零列向量 <code>v</code>，该向量将用作基的变换矩阵的一部分。</p><p>然后接下就到循环部分：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>p</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>irr</span><span class=p>,</span> <span class=n>m</span> <span class=ow>in</span> <span class=n>multiplicities</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>assert</span> <span class=n>irr</span><span class=o>.</span><span class=n>size</span> <span class=o>&gt;=</span> <span class=n>m</span>
</span></span><span class=line><span class=cl>    <span class=n>s</span> <span class=o>=</span> <span class=n>irr</span><span class=o>.</span><span class=n>size</span>
</span></span><span class=line><span class=cl>    <span class=n>v</span><span class=p>[</span><span class=n>p</span><span class=p>:</span><span class=n>p</span><span class=o>+</span><span class=n>m</span><span class=o>*</span><span class=n>s</span><span class=p>,</span> <span class=mi>0</span><span class=p>]</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>eye</span><span class=p>(</span><span class=n>m</span><span class=p>,</span> <span class=n>s</span><span class=p>)</span><span class=o>.</span><span class=n>reshape</span><span class=p>(</span><span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>s</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>p</span> <span class=o>+=</span> <span class=n>m</span><span class=o>*</span><span class=n>s</span>
</span></span></code></pre></td></tr></table></div></div><ul><li>对于每个不可约表示<code>irr</code>和其对应的重数<code>m</code>:<ul><li><code>s = irr.size</code>：获取不可约表示的维度。</li><li><code>np.eye(m, s).reshape(-1) * np.sqrt(s)</code>：生成一个大小为 <code>(m, s)</code> 的单位矩阵，并对其进行重塑（reshape）以变成一个列向量，并乘以 $\sqrt{s}$。</li><li><code>v[p:p+m*s, 0] = ...</code>：将生成的列向量放置在 <code>v</code> 的适当位置，根据当前 <code>p</code> 的值和表示的维度 <code>s</code>。</li><li><code>p += m*s</code>：更新下一个表示的起始位置。</li></ul></li></ul><p>然后的话看接下来的代码：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>change_of_basis</span> <span class=o>=</span> <span class=n>np</span><span class=o>.</span><span class=n>zeros</span><span class=p>((</span><span class=n>size</span><span class=p>,</span> <span class=n>size</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=n>np</span><span class=o>.</span><span class=n>set_printoptions</span><span class=p>(</span><span class=n>precision</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span> <span class=n>threshold</span><span class=o>=</span><span class=mi>10</span><span class=o>*</span><span class=n>size</span><span class=o>**</span><span class=mi>2</span><span class=p>,</span> <span class=n>suppress</span><span class=o>=</span><span class=kc>False</span><span class=p>,</span> <span class=n>linewidth</span><span class=o>=</span><span class=mi>25</span><span class=o>*</span><span class=n>size</span> <span class=o>+</span> <span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>for</span> <span class=n>e</span> <span class=ow>in</span> <span class=n>group</span><span class=o>.</span><span class=n>elements</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>ev</span> <span class=o>=</span> <span class=n>P</span><span class=p>(</span><span class=n>e</span><span class=p>)</span> <span class=o>@</span> <span class=n>v</span>
</span></span><span class=line><span class=cl>    <span class=n>change_of_basis</span><span class=p>[</span><span class=n>index</span><span class=p>[</span><span class=n>e</span><span class=p>],</span> <span class=p>:]</span> <span class=o>=</span> <span class=n>ev</span><span class=o>.</span><span class=n>T</span>
</span></span><span class=line><span class=cl><span class=n>change_of_basis</span> <span class=o>/=</span> <span class=n>np</span><span class=o>.</span><span class=n>sqrt</span><span class=p>(</span><span class=n>size</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><p>这一部分代码是计算群的正则表示的基之间的变换矩阵。它使用之前构建的直和表示 <code>P</code> 和基的变换矩阵 <code>v</code>，来计算群的元素之间的表示矩阵，最终得到基的变换矩阵 <code>change_of_basis</code>。</p><ol><li><strong><code>change_of_basis = np.zeros((size, size))</code></strong>：</li></ol><ul><li>创建一个大小为 <code>(size, size)</code> 的全零矩阵 <code>change_of_basis</code>，该矩阵将存储基之间的变换矩阵。</li></ul><ol start=2><li><p><strong><code>np.set_printoptions(...)</code></strong>：</p><ul><li>设置打印选项，以便后续打印变换矩阵时能够更好地显示数值。</li></ul></li><li><p><strong><code>for e in group.elements:</code></strong>：</p><ul><li>对于群中的每个元素 <code>e</code>：</li></ul></li><li><p><strong><code>ev = P(e) @ v</code></strong>：</p><ul><li>计算群元素 <code>e</code> 对应的表示矩阵，通过用直和表示 <code>P</code> 对 <code>e</code> 作用于基的变换矩阵 <code>v</code></li></ul></li><li><p><strong><code>change_of_basis[index[e], :] = ev.T</code></strong>：</p><ul><li>将得到的表示矩阵 <code>ev</code> 的转置（为了匹配矩阵维度）存储在 <code>change_of_basis</code> 中，位置由 <code>index[e]</code> 确定。</li></ul></li><li><p><strong><code>change_of_basis /= np.sqrt(size)</code></strong>：</p><ul><li>对整个 <code>change_of_basis</code> 矩阵进行归一化处理，以确保该变换矩阵是正交的。</li></ul></li><li><p><code>change_of_basis_inv = change_of_basis.T</code></p><ul><li>将矩阵进行转置。</li></ul></li></ol><p>然后返回对应的 变量，一致返回到最开始。</p><h2 id=总结><a href=#%e6%80%bb%e7%bb%93>#</a>
总结</h2><p>上面虽然介绍了 e2cnn 等变群卷积创建群 的过程，但是 实话实说，整体流程仍然是云里雾里，因此我们需要对里面 的流程做一个重新的梳理。</p><ol><li>指定群的阶数，调用 Rot2dOnR2 进行初始化。</li><li>判断传入 N 的大小，如果说现在是大于 0 的话创建 循环群，小于 0 的话创建的 是离散群。这篇博客仅仅讨论 循环群的创建。</li><li>确定为循环群，调用循环群<code>cyclic_group</code>的初始化。将回调用<code>_generator</code>里面的 CyclicGroup 函数，初始化对应的循环群。</li><li>初始化群元素的给个数，名称，表示，然后调用<code>_build_representations</code>构建群。</li><li>首先构建群的不可约表示，因为现在使用的是 循环群（对称群），这个时候不可约表示肯定不会超过其中的一半。</li><li>根据传入的群的阶数不同，每个群中的元素需要分别使用不同的初始化方式进行构建，这个详细请看上面的介绍。<ol><li>注意，这里面有坑点，里面使用了 lamda 表达式，会在 使用的时候才会进行初始化。</li></ol></li><li>下面将会构建对应的 regular 层，这里的话其实就是根据我们上面计算出来的 irreps（不可约表示），计算对应的 irreps, change_of_basis, change_of_basis_inv。这个就像与 构建 了群的 常规表示。</li></ol><p>以上 就是循环群的创建，但是在第 7 点，里面的细节没有讲清楚，这里的话其实应该结合论文来看。</p><p><img src=https://img-1312072469.cos.ap-nanjing.myqcloud.com/20231203202637.png loading=lazy></p><p><img src=https://img-1312072469.cos.ap-nanjing.myqcloud.com/20231203203118.png loading=lazy></p><p>讲道理，上面的源码当中，表示了循环群的常规表示法，也构建了向量$v$，构建了对应的表示，在构建对应的表示的时候，使用到了每个群元素中的 表示，对应上面公式，就能解释的通</p><p><img src=https://img-1312072469.cos.ap-nanjing.myqcloud.com/20231203203749.png loading=lazy></p><p><img src=https://img-1312072469.cos.ap-nanjing.myqcloud.com/20231203204110.png loading=lazy></p><p>最关键就是这里的转换，就是有了着了的转换，才能使用上面对应的内容进行表示。</p></section><footer class=article-footer><section class=article-tags><a href=/tags/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/>机器学习</a>
<a href=/tags/%E6%BA%90%E7%A0%81%E9%98%85%E8%AF%BB/>源码阅读</a>
<a href=/tags/%E7%BE%A4%E8%AE%BA/>群论</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Apache Licence 2.0</span></section></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css integrity=sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV crossorigin=anonymous><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.js integrity=sha384-XjKyOOlGwcjNTAIQHIpgOno0Hl1YQqzUOEleOLALmuqehneUG+vnGctmUb0ZY0l8 crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous defer></script><script>window.addEventListener("DOMContentLoaded",()=>{renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1},{left:"\\[",right:"\\]",display:!0}],ignoredClasses:["gist"]})})</script></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/p/e2cnn-%E5%86%85%E5%AE%B9%E7%90%86%E8%A7%A3-r2conv-%E8%AF%A6%E8%A7%A3/><div class=article-details><h2 class=article-title>e2cnn 内容理解-R2Conv 详解</h2></div></a></article><article><a href=/p/e2cnn-%E5%86%85%E5%AE%B9%E7%90%86%E8%A7%A3-%E7%BE%A4%E7%9A%84%E8%BE%93%E5%87%BA%E7%B1%BB%E5%9E%8B/><div class=article-details><h2 class=article-title>e2cnn 内容理解 - 群的输出类型</h2></div></a></article><article><a href=/p/e2cnn%E5%86%85%E5%AE%B9%E7%90%86%E8%A7%A3-%E7%BE%A4%E7%9A%84%E8%BE%93%E5%85%A5%E7%B1%BB%E5%9E%8B/><div class=article-details><h2 class=article-title>e2cnn内容理解-群的输入类型</h2></div></a></article><article><a href=/p/conv2d%E7%9A%84%E7%AE%80%E5%8D%95%E7%90%86%E8%A7%A3/><div class=article-details><h2 class=article-title>Conv2d的简单理解</h2></div></a></article></div></div></aside><script src=//unpkg.com/@waline/client@v2/dist/waline.js></script><link href=//unpkg.com/@waline/client@v2/dist/waline.css rel=stylesheet><div id=waline class=waline-container></div><style>.waline-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding);--waline-font-size:var(--article-font-size)}.waline-container .wl-count{color:var(--card-text-color-main)}</style><script>Waline.init({avatar:"retro",avatarcdn:"https://sdn.geekzu.org/avatar/",dark:'html[data-scheme="dark"]',el:"#waline",emoji:["https://cdn.jsdelivr.net/gh/walinejs/emojis/weibo"],highlight:!0,js:"https://cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js",lang:"zh-CN",locale:{admin:"Admin",placeholder:null},meta:["nick","mail","link"],pageSize:20,placeholder:"",requiredMeta:["name","email","url"],serverURL:"https://waline-line-git-main-zrsaber.vercel.app",uploadimage:!1,visitor:!0})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2024 Runqi Blog</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.25.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>